<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/wap.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<!-- 选中地区 开始 -->
	<link rel="stylesheet" type="text/css" href="js/city/LArea.css">
	<script src="js/city/LArea.js"></script>
	<script src="js/city/LAreaData1.js"></script>
	<script src="js/city/LAreaData2.js"></script>
	<!-- 选中地区 结束 -->
</head>
<body>
	<div class="header">
		<a href="index.html" class="home"><img src="images/home.fw.png" /></a>
	</div>
	<div class="main padd">
		<div class="cart_title">
			<b>我的购物车，共<font class="red_col">2</font>件商品</b>
			<a class="gray_col">清除</a>
		</div>
		<!-- 商品列表 -->
		<div class="cart_pro_list">
			<!-- 商品 -->
			<div class="cart_product" data-index="goods">
				<label onclick="inpCheck(this)">
					<input type="checkbox" />
					<b><img src="images/prduct1.fw.png"></b>
				</label>
				<span>
					<h3>8只大众蟹豪华礼盒</h3>
					<p class="gray_col2">4只公蟹2.5-3两</p>
					<p class="gray_col2">4只母蟹2.0-2.5两</p>
					<strong>
						<input type="button" name="minus" value="-" class="jiajian minus" onclick="doMinus(this,999.00)" />
						<input type="number" name="num" value="1" class="number">
						<input type="button" name="plus" value="+" class="jiajian plus" onclick="doPlus(this,999.00)" />
						<!-- <input type="hidden" name="mass[{$key}]" class="mass" value="8.5" data-fufei='<eq name="vo.type" value="2">1</eq><eq name="vo.type" value="1">1</eq><eq name="vo.type" value="3">0</eq>'> -->
						<input type="hidden" name="mass[{$key}]" class="mass" value="8.5" data-fufei='1'>
						<input type="hidden" name="price[{$key}]" value="1">
						<input type="hidden" name="id[{$key}]" value="{$vo.id}">
					</strong>
					<h2 class="red_col">￥<font>999.00</font></h2>
				</span>
				<strong class="delect"><i>×</i></strong>
			</div>
			<!-- 商品 -->
			<div class="cart_product" data-index="goods">
				<label onclick="inpCheck(this)">
					<input type="checkbox" />
					<b><img src="images/prduct1.fw.png"></b>
				</label>
				<span>
					<h3>8只大众蟹豪华礼盒</h3>
					<p class="gray_col2">4只公蟹2.5-3两</p>
					<p class="gray_col2">4只母蟹2.0-2.5两</p>
					<strong>
						<input type="button" name="minus" value="-" class="jiajian minus" onclick="doMinus(this)" />
						<input type="number" name="num" value="1" class="number">
						<input type="button" name="plus" value="+" class="jiajian plus" onclick="doPlus(this)" />
					</strong>
					<h2 class="red_col">￥999.00</h2>
				</span>
				<strong class="delect"><i>×</i></strong>
			</div>
			<!-- 商品 -->
			<div class="cart_product" data-index="wine">
				<label onclick="inpCheck(this)">
					<input type="checkbox" />
					<b><img src="images/prduct1.fw.png"></b>
				</label>
				<span>
					<h3>8只大众蟹豪华礼盒</h3>
					<p class="gray_col2">4只公蟹2.5-3两</p>
					<p class="gray_col2">4只母蟹2.0-2.5两</p>
					<strong>
						<input type="button" name="minus" value="-" class="jiajian minus" onclick="doMinus(this)" />
						<input type="number" name="num" value="1" class="number">
						<input type="button" name="plus" value="+" class="jiajian plus" onclick="doPlus(this)" />
					</strong>
					<h2 class="red_col">￥999.00</h2>
				</span>
				<strong class="delect"><i>×</i></strong>
			</div>
		</div>
		<div class="clear"></div>
		<!-- 用户信息 -->
		<div class="user_info">
			<!-- 购买人 -->
			<div class="sl_user">
				<h3>购买人信息</h3>
				<input type="text" name="suser" id="suser" placeholder="姓名" />
				<input type="tel" name="sphone" id="sphone" placeholder="联系电话" onblur="validatePhone(this)" />
			</div>
			<!-- 收货人 -->
			<div class="sl_user">
				<h3>收货人信息</h3>
				<input type="text" name="huser" id="huser" placeholder="姓名" />
				<input type="tel" name="hphone" id="hphone" placeholder="联系电话" onblur="validatePhone(this)" />
				<style type="text/css">
					.area_ctrl{height: 240px;}
				</style>
				<input type="text" name="city" id="demo1" readonly="true" placeholder="选择省市" />
				<input id="value1" type="hidden" />
				<textarea placeholder="街道信息" id="streen" /></textarea>
			</div>
		</div>
		<div class="kd_info">
			<em>顺丰快递/<font class="red_col" id="shunfeng">22.00</font>元</em>
			<input type="checkbox" class="shunfeng_ems" id="sfkd" style="display:none;" />
			<label for="sfkd" onclick="plushEMS(this);">到付</label>
		</div>
		<div class="prompt">
			<h3>支付成功后，您将收到订单编号，可随时登录官方查看物流信息</h3>
			<i>如未收到短信息请联系客服</i>
		</div>
	</div>
	<div class="footer"></div>
	<!-- 底部导航栏 -->
	<div class="mytools">
		<span>共<font id="pro_sum">3</font>件，需支付￥<i id="totals_price">0</i><input type="hidden" name="totals_price" value="999" id="totals_price1"></span>
		<a href="javascript:void(0);" id="online_pay" class="my_float_r addcart orange_bg">在线支付</a>
	</div>
</body>
<script type="text/javascript">
	var phoneReg = /^1[3|4|5|7|8]\d{9}$/;
	$(function(){
		// 去除input样式
		$('.user_info input').focus(function() {
			$(this).removeClass('enter_error');
		});

		// 初次输入，收货人信息 == 购买人信息
		$('#suser').keyup(function(){
			$('#huser').val($(this).val());
		});
		$('#sphone').keyup(function(){
			$('#hphone').val($(this).val());
		});

		// 支付
		$('#online_pay').click(function(){
			if($('#suser').val() == ''){
				$('#suser').addClass('enter_error');
				return false;
			}
			if($('#sphone').val() == ''){
				$('#sphone').addClass('enter_error');
				return false;
			}
			if(!phoneReg.test($('#sphone').val())){
				$('#sphone').addClass('enter_error');
				return false;
			}
			if($('#huser').val() == ''){
				$('#huser').addClass('enter_error');
				return false;
			}
			if($('#hphone').val() == ''){
				$('#hphone').addClass('enter_error');
				return false;
			}
			if(!phoneReg.test($('#hphone').val())){
				$('#hphone').addClass('enter_error');
				return false;
			}
			if($('#demo1').val() == ''){
				$('#demo1').addClass('enter_error');
				return false;
			}
			if($('#streen').val() == ''){
				$('#streen').addClass('enter_error');
				return false;
			}
		});
	});

	// 购物车商品选中状态
	function inpCheck(obj){
		$obj =$(obj);
		if($obj.children('input').is(':checked')){
			$obj.parent().addClass('cart_check');
		}else{
			$obj.parent().removeClass('cart_check');
		}
		$('#totals_price').text(get_all_price());
	}

	// 选择城市
	var area1 = new LArea();
		area1.init({
		'trigger': '#demo1',
		'valueTo': '#value1',
		'keys' :{
			id:'value',
			name:'text'
		},
		'type': 2,
		'data': [provs_data, citys_data, dists_data]
	});

	// 手机验证
	function validatePhone(obj){
		var val = obj.value;
		if(val == ''){
			obj.className = 'enter_error';
			return false;
		}
		if(!phoneReg.test(val)){
			obj.className = 'enter_error';
			return false;
		}
	}

	// 增加减少
	$price = $('.red_col').text();
	function doPlus(obj,p){
		$obj = $(obj);
		var num = $obj.siblings('input[type="number"]').val();
		if(num == 0){
			$('.minus').on('click',function(){
				doMinus(this);
			});
		}
		++num;
		if (num < 0)
			num = 1;
		$obj.prev().val(num);
		$tt = get_orther_price($obj,num);
		// $obj.siblings('input[type="number"]').val(num);
		$('#totals_price').text($tt);
	}
	function doMinus(obj,p){
		$obj = $(obj);
		var num = $obj.siblings('input[type="number"]').val();
		--num;
		if (num < 0) {
			$obj.removeAttr('onclick');
			num = 0;
		}
		$obj.siblings('input[type="number"]').val(num);
		$tt = get_orther_price($obj,num);
		$('#totals_price').text($tt);
		$('#totals_price1').val($tt);
	}

	/**
	 * 获取除去自己外其他的价格
	 * @param obj
	 * @returns {number}
     */
	function get_orther_price(obj,num) {
		$prices =0;
		$sf =0;
		$p = obj.parent().parent().parent();
		$('.cart_product').each(function () {
			if($(this).index()!=$p.attr('data-index')){
				if($(this).children('label').children('input[type="checkbox"]').is(':checked')){
					$price = $(this).children('span').children('h2').children('font').text();
					$sum = $(this).children('span').children('strong').children('input[type="number"]').val();
					$sf += parseInt($sum);
					$prices += parseInt($price)*parseInt($sum);
				}
			}
		});
		$sm = get_ems_price();
		if($('#sfkd').is(':checked')){
			$sm=0;
		}
		$('#pro_sum').text($sf);
		$('#totals_price1').val($prices + $sm);
		return $prices + $sm;
	}

	/**
	 * 获取所有的价格
	 * @returns {number}
	 */
	function get_all_price() {
		$prices =0;
		$sf=0;
		$('.cart_product').each(function () {
			if($(this).children('label').children('input[type="checkbox"]').is(':checked')){
				$price = $(this).children('span').children('h2').children('font').text();
				$sum = $(this).children('span').children('strong').children('input[type="number"]').val();
				$ll =parseInt($price)*parseInt($sum);
				$prices +=$ll;
				$sf += parseInt($sum);
			}
		});
		$('#pro_sum').text($sf);
		$tt= get_ems_price();
		if($('#sfkd').is(':checked')){
			$tt=0;
		}
		$('#totals_price1').val($prices + $tt);
		return $prices+$tt;
	}

	function plushEMS(obj) {
		$('#totals_price').text(get_all_price());
	}

	// 快递钱
	function get_ems_price() {
		$mass=0;
		$price = parseInt($('#shunfeng').text());
		$tal=0;
		$('.cart_product').each(function () {
			if($(this).children('label').children('input[type="checkbox"]').is(':checked')){
				$number = $(this).children('span').children('strong').children('input.number').val();
				$input = $(this).children('span').children('strong').children('input.mass');
				if($input.attr('data-fufei')==1){
					if($input.val()!=''){
						$mass = parseFloat($input.val());
						if($mass<=1){
							$tal = $price;
						}else {
							$tal = $price+(($mass*$number)-1)*14;
						}
					}
				}
			}
		});

		// $('#mass_totals').text("￥"+$tal);
//		if($('.shunfeng_ems').is(':checked')){
//			$('#totals_price').text(parseInt($('#totals_price').text())-$tal);
//		}else{
//			$('#totals_price').text(parseInt($('#totals_price').text())+$tal);
//		}
		return parseFloat($tal);
	}
</script>
</html>